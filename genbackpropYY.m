% yin-yang demo for the generic backpropagation

function genbackpropYY

x=[1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1;%0
1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0;
1  1 1 1 1 0  1 0 0 1 0  1 0 0 1 0  1 0 0 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 0;
1  0 1 1 1 1  0 1 0 0 1  0 1 0 0 1  0 1 0 0 1  0 1 0 0 1  0 1 0 0 1  0 1 1 1 1;
1  0 1 1 1 0  1 0 0 0 1  1 0 0 1 1  1 0 1 0 1  1 1 0 0 1  1 0 0 0 1  0 1 1 1 0;

1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1;%1
1  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0;
1  0 0 0 1 0  0 0 1 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0;
1  0 0 1 0 0  0 1 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 1 1 1 0;
1  0 0 0 1 0  0 0 1 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 1 1 1;

1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1;%2
1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 1 1 1 1;
1  1 1 1 1 1  1 0 0 0 1  0 0 0 0 1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 1  1 1 1 1 1;
1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  0 1 1 1 0  1 0 0 0 0  1 0 0 0 1  0 1 1 1 0;
1  0 1 1 1 0  1 0 0 0 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 1  0 1 1 1 0;

1  1 1 1 1 1  1 0 0 0 1  0 0 0 0 1  0 0 1 1 0  0 0 0 0 1  1 0 0 0 1  1 1 1 1 1;%3
1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1;
1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  0 0 1 1 0  0 0 0 0 1  1 0 0 0 1  0 1 1 1 0;
1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  0 1 1 1 0  0 0 0 0 1  1 0 0 0 1  0 1 1 1 0;
1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  1 1 1 1 1  0 0 0 0 1  1 0 0 0 1  0 1 1 1 0;

1  0 0 0 1 0  0 0 1 1 0  0 1 0 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 1  0 0 0 1 0;%4
1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1;
1  1 0 0 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 1  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0;
1  0 0 0 1 1  0 0 1 0 1  0 1 0 0 1  1 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1;
1  0 0 0 0 1  0 0 0 1 1  0 0 1 0 1  0 1 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1;

1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1;%5
1  1 1 1 1 0  1 0 0 0 0  1 1 1 1 0  0 0 0 1 0  1 1 1 1 0  0 0 0 0 0  0 0 0 0 0;
1  0 0 0 0 0  0 0 0 0 0  0 1 1 1 1  0 1 0 0 0  0 1 1 1 1  0 0 0 0 1  0 1 1 1 1;
1  0 0 0 0 0  0 1 1 1 0  0 1 0 0 0  0 1 1 1 0  0 0 0 1 0  0 1 1 1 0  0 0 0 0 0;
1  0 0 0 0 0  1 1 1 1 1  1 0 0 0 0  1 1 1 1 1  0 0 0 0 1  1 1 1 1 1  0 0 0 0 0;

1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1;%6
1  1 1 1 1 0  1 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 0 0  0 0 0 0 0;
1  0 0 0 0 0  0 0 0 0 0  0 0 1 1 1  0 0 1 0 0  0 0 1 1 1  0 0 1 0 1  0 0 1 1 1;
1  0 0 0 0 0  0 0 0 0 0  0 1 0 0 0  0 1 0 0 0  0 1 1 1 1  0 1 0 0 1  0 1 1 1 1;
1  0 0 0 0 0  0 0 0 0 0  1 1 1 0 0  1 0 0 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0;

1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1;%7
1  1 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0  0 0 0 0 0;
1  1 1 1 1 1  0 0 0 0 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0;
1  1 1 1 1 1  0 0 0 0 1  0 0 0 1 0  0 1 1 1 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0;
1  0 1 0 1 1  1 0 1 0 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0;

1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1;%8
1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0;
1  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0  0 0 0 0 0  0 0 0 0 0;
1  0 0 0 0 0  0 0 1 0 0  0 1 0 1 0  0 0 1 0 0  0 1 0 1 0  0 0 1 0 0  0 0 0 0 0;
1  0 0 0 0 0  0 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 1 1 1 0  1 0 0 1 0  1 1 1 1 0;

1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1;%9
1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 1  0 0 0 0 1  1 0 0 0 1  0 1 1 1 0;
1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1;
1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 0 0 1 0;
1  0 0 0 0 0  0 1 1 1 0  0 1 0 1 0  0 1 1 1 0  0 0 0 1 0  0 0 1 1 0  0 0 0 0 0;];

    x_Teszt = [1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1;
1  0 0 1 0 0  0 1 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 1 1 1 0;
1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1;
1  1 1 1 1 1  1 0 0 0 1  0 0 0 0 1  0 1 1 1 0  0 0 0 0 1  1 0 0 0 1  1 1 1 1 1;
1  0 0 0 0 1  0 0 0 1 1  0 0 1 0 1  0 1 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1;
1  0 0 0 0 0  0 0 0 0 0  0 1 1 1 1  0 1 0 0 0  0 1 1 1 1  0 0 0 0 1  0 1 1 1 1;
1  0 0 0 0 0  0 0 0 0 0  1 1 1 0 0  1 0 0 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0;
1  1 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0  0 0 0 0 0;
1  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0  0 0 0 0 0  0 0 0 0 0;
1  0 0 0 0 0  0 1 1 1 0  0 1 0 1 0  0 1 1 1 0  0 0 0 1 0  0 0 1 1 0  0 0 0 0 0;];

%d =[0;0;0;0;0;1;1;1;1;1;2;2;2;2;2;3;3;3;3;3;4;4;4;4;4;5;5;5;5;5;6;6;6;6;6;7;7;7;7;7;8;8;8;8;8;9;9;9;9;9];
%d_Teszt = [0;1;2;3;4;5;6;7;8;9];
   d=[1 0 0 0 0 0 0 0 0 0;%0
   1 0 0 0 0 0 0 0 0 0;
   1 0 0 0 0 0 0 0 0 0;
   1 0 0 0 0 0 0 0 0 0;
   1 0 0 0 0 0 0 0 0 0;
   0 1 0 0 0 0 0 0 0 0;%1
   0 1 0 0 0 0 0 0 0 0;
   0 1 0 0 0 0 0 0 0 0;
   0 1 0 0 0 0 0 0 0 0;
   0 1 0 0 0 0 0 0 0 0;
   0 0 1 0 0 0 0 0 0 0;%2
   0 0 1 0 0 0 0 0 0 0;
   0 0 1 0 0 0 0 0 0 0;
   0 0 1 0 0 0 0 0 0 0;
   0 0 1 0 0 0 0 0 0 0;
   0 0 0 1 0 0 0 0 0 0;%3
   0 0 0 1 0 0 0 0 0 0;
   0 0 0 1 0 0 0 0 0 0;
   0 0 0 1 0 0 0 0 0 0;
   0 0 0 1 0 0 0 0 0 0;
   0 0 0 0 1 0 0 0 0 0;%4
   0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 0 1 0 0 0 0;%5
   0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 0 1 0 0 0;%6
   0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 0 1 0 0;%7
   0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 0 1 0;%8
   0 0 0 0 0 0 0 0 1 0;
   0 0 0 0 0 0 0 0 1 0;
   0 0 0 0 0 0 0 0 1 0;
   0 0 0 0 0 0 0 0 1 0;
   0 0 0 0 0 0 0 0 0 1;%9
   0 0 0 0 0 0 0 0 0 1;
   0 0 0 0 0 0 0 0 0 1;
   0 0 0 0 0 0 0 0 0 1;
   0 0 0 0 0 0 0 0 0 1;];

d_Teszt=[1 0 0 0 0 0 0 0 0 0;
   0 1 0 0 0 0 0 0 0 0;
   0 0 1 0 0 0 0 0 0 0;
   0 0 0 1 0 0 0 0 0 0;
   0 0 0 0 1 0 0 0 0 0;
   0 0 0 0 0 1 0 0 0 0;
   0 0 0 0 0 0 1 0 0 0;
   0 0 0 0 0 0 0 1 0 0;
   0 0 0 0 0 0 0 0 1 0;
   0 0 0 0 0 0 0 0 0 1;];

theta = @tanh;
dtheta= @(x) 1 - theta(x).^2;


layers = [36 12 12 10];

W = genbackprop(x, d, layers, theta, dtheta, 500, 0.01, 0.003);
m = size(d_Teszt,1);
for i = 1:m
    s1 = W{1} * (x_Teszt(i,:)');
    y1 = theta(s1);
    s2 = W{2}*y1;
    y2{i} = theta(s2);
end
for i = 1:m
    v = y2{i}(i)
    for j = 1:10
        if v == y2{i}(j)
            d_pred(i) = j - 1;
        end
        if d_Teszt(i,j) == 1
            d_elvart(i) = j - 1;
        end
    end
end
figure(1)
x = 0:9
plot(d_elvart,x,'g*')
grid on
hold on
plot(d_pred,x,'b.')


figure('Name','Confusion matrix','NumberTitle','off');
% c = [0,1,2,3,4,5,6,7,8,9]
% confusionchart(c(d_pred),c(d_elvart))
confusion_matrix = zeros(10,10);
for i=1:10
    for j=1:10
        if d_pred(j)==d_elvart(i)
            confusion_matrix(i,j)=confusion_matrix(i,j)+1;
        end
    end
end

n = 10;
Arot = flipud(confusion_matrix);
Arot = [ Arot; Arot(end,:) ];
Arot = [ Arot, Arot(:,end) ];
pcolor(Arot);
for i = 1 : n
  for j = 1 : m
    text(i + .5 , j + .5 ,num2str(Arot(j,i)),'FontSize',18);
  end
end

figure(2)
plotconfusion(d_pred,d_elvart)